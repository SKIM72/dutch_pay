<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="appTitle">Settle Up | Modern Settlement</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=2">
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>Settle Up</h1>
            <div class="language-selector">
                <i class="fas fa-globe"></i>
                <select id="language-switcher">
                    <option value="ko">한국어</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                </select>
            </div>
        </header>

        <div id="main-container">
            <aside id="left-pane">
                <div class="sidebar-content">
                    <h2 data-i18n="settlementHistory">정산 내역 조회</h2>
                    <input type="date" id="main-date-picker">
                    <div id="settlement-list-container"></div>
                </div>
            </aside>

            <main id="right-pane">
                <div id="placeholder-right-pane">
                    <i class="fas fa-wallet"></i>
                    <p data-i18n="selectOrCreateSettlement">정산 건을 선택하거나 새로운 정산을 시작하세요.</p>
                </div>
                
                <div id="calculator" class="hidden">
                    <div class="settlement-header">
                        <h2 id="settlement-display"></h2>
                        <span id="settlement-date-badge" class="settlement-date-badge" style="cursor: pointer;" title="환율 정보 보기"></span>
                    </div>
                    
                    <div class="card" id="summary-card">
                        <div class="summary-left">
                            <h2><i class="fas fa-chart-pie"></i><span data-i18n="settlementResult"></span></h2>
                            <div id="total-expense" data-i18n="totalExpense">총 지출: 0 JPY</div>
                        </div>
                        <div class="summary-right">
                            <p id="final-settlement"></p>
                            <button id="complete-settlement-btn" class="hidden"></button>
                        </div>
                    </div>

                    <div class="card" id="expense-form-card">
                        <h2><i class="fas fa-plus-circle"></i><span data-i18n="addExpense"></span></h2>
                        <div id="expense-form">
                            <div class="form-grid-row">
                                <input type="text" id="item-name" data-i18n-placeholder="expenseItem">
                                <div class="amount-input-wrapper">
                                    <input type="text" id="item-amount" data-i18n-placeholder="amount" inputmode="decimal">
                                    <select id="item-currency">
                                        <option value="JPY">JPY</option>
                                        <option value="KRW">KRW</option>
                                        <option value="USD">USD</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-grid-row">
                                <select id="item-payer"></select>
                                <select id="split-method" data-i18n-options="splitEqually,splitByAmount"></select>
                            </div>
                            <div id="split-amount-inputs" class="hidden form-grid-row">
                                <input type="text" id="split-amount-a" data-i18n-placeholder="participant1Share" inputmode="decimal">
                                <input type="text" id="split-amount-b" data-i18n-placeholder="participant2Share" inputmode="decimal">
                            </div>
                            <button id="add-expense-btn" data-i18n="recordExpense"></button>
                        </div>
                    </div>

                    <div class="card" id="expense-list-card">
                        <div class="card-header">
                            <h2><i class="fas fa-list"></i><span data-i18n="detailedExpenseList"></span></h2>
                            <button id="download-excel-btn"><i class="fas fa-download"></i><span data-i18n="downloadExcel"></span></button>
                        </div>
                        <div id="expense-table-container">
                            <table id="expense-table">
                                <thead>
                                    <tr>
                                        <th data-i18n="tableHeaderItem">항목</th>
                                        <th data-i18n="tableHeaderTotal">총액</th>
                                        <th data-i18n="tableHeaderPayer">결제자</th>
                                        <th id="table-header-user-a" data-i18n="tableHeaderParticipant1">참가자 1</th>
                                        <th id="table-header-user-b" data-i18n="tableHeaderParticipant2">참가자 2</th>
                                        <th data-i18n="tableHeaderActions">관리</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <button id="add-settlement-fab"><i class="fas fa-plus"></i></button>

        <div id="add-settlement-modal" class="hidden">
             <div class="modal-content card">
                <span class="close-modal-btn"><i class="fas fa-times"></i></span>
                <div class="modal-header">
                    <h2 data-i18n="newSettlement"></h2>
                    <span id="modal-date-display" class="settlement-date-badge"></span>
                </div>
                <input type="text" id="new-settlement-title" data-i18n-placeholder="settlementTitlePlaceholder">
                <div class="participant-inputs">
                    <input type="text" id="new-participant-a" value="A" data-i18n-placeholder="participant1Name">
                    <input type="text" id="new-participant-b" value="B" data-i18n-placeholder="participant2Name">
                </div>
                <div class="currency-select-wrapper">
                    <label for="base-currency" data-i18n="baseCurrency">기준 통화:</label>
                    <select id="base-currency">
                        <option value="JPY">JPY (일본 엔)</option>
                        <option value="KRW">KRW (한국 원)</option>
                        <option value="USD">USD (미국 달러)</option>
                    </select>
                </div>
                <button id="create-settlement-btn" data-i18n="create"></button>
            </div>
        </div>

        <div id="exchange-rate-modal" class="hidden">
            <div class="modal-content card">
                <span class="close-modal-btn"><i class="fas fa-times"></i></span>
                <div class="modal-header">
                    <h2 data-i18n="exchangeRateTitle">환율 정보</h2>
                </div>
                <p id="exchange-rate-date"></p>
                <div id="exchange-rate-info"></div>
            </div>
        </div>

        <div id="edit-expense-modal" class="hidden">
            <div class="modal-content card">
                <span class="close-modal-btn"><i class="fas fa-times"></i></span>
                <input type="hidden" id="edit-expense-id">
                <h2 data-i18n="editExpense">지출 수정</h2>
                <div class="form-grid-row" style="margin-top: 1rem;">
                    <input type="text" id="edit-item-name" data-i18n-placeholder="expenseItem">
                    <div class="amount-input-wrapper">
                        <input type="text" id="edit-item-amount" data-i18n-placeholder="amount" inputmode="decimal">
                        <select id="edit-item-currency"></select>
                    </div>
                </div>
                <div class="form-grid-row">
                    <select id="edit-item-payer"></select>
                    <select id="edit-split-method" data-i18n-options="splitEqually,splitByAmount"></select>
                </div>
                <div id="edit-split-amount-inputs" class="hidden form-grid-row">
                    <input type="text" id="edit-split-amount-a" inputmode="decimal">
                    <input type="text" id="edit-split-amount-b" inputmode="decimal">
                </div>
                <button id="save-expense-changes-btn" data-i18n="saveChanges"></button>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="locales.js"></script>
    <script src="main.js?v=2"></script>
</body>
</html>